<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0f1e16" />
    <link rel="manifest" href="manifest.webmanifest" />
    <title>Plant Tracker</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%2308a57b' d='M50 8c8 20 23 25 23 38 0 9-7 15-15 17 4-10-1-24-8-33-7 9-12 23-8 33-8-2-15-8-15-17 0-13 15-18 23-38Z'/%3E%3Crect x='47' y='60' width='6' height='30' rx='3' fill='%232e3e37'/%3E%3C/svg%3E" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <h1>Plant Tracker</h1>
      <nav class="top-actions">
        <button id="addPlantBtn" class="btn primary">Add Plant</button>
        <button id="icsBtn" class="btn">Reminders (.ics)</button>
        <button id="shareBtn" class="btn">Share</button>
        <button id="exportBtn" class="btn">Export</button>
        <label class="import">
          <input id="importInput" type="file" accept="application/json" hidden />
          <span class="btn">Import</span>
        </label>
      </nav>
    </header>

    <main id="view-root">
      <section id="dashboardView" class="view active">
        <section id="sciencePanel" class="card science">
          <div class="science-grid">
            <div>
              <div class="label">Season</div>
              <select id="seasonSelect">
                <option value="growing" selected>Growing</option>
                <option value="peak">Peak</option>
                <option value="dormant">Dormant</option>
              </select>
            </div>
            <div>
              <div class="label">Temp (°C)</div>
              <input id="tempInput" type="number" step="0.1" placeholder="22" />
            </div>
            <div>
              <div class="label">RH (%)</div>
              <input id="rhInput" type="number" step="1" placeholder="50" />
            </div>
            <div>
              <div class="label">Model</div>
              <div id="modelSummary" class="muted">—</div>
            </div>
          </div>
          <div class="actions" style="margin-top:.5rem; justify-content:flex-start">
            <button id="useWeather" class="btn">Use Local Weather</button>
          </div>
        </section>
        <div class="toolbar">
          <h2>Upcoming Watering</h2>
          <div class="hint">Light, pot, and science multipliers</div>
        </div>
        <ul id="plantList" class="plant-list"></ul>
      </section>

      <section id="editorView" class="view">
        <form id="plantForm" class="card" autocomplete="off">
          <input type="hidden" id="plantId" />
          <div class="row">
            <label for="plantName">Name</label>
            <input id="plantName" required placeholder="e.g., Monstera" />
          </div>
          <div class="row">
            <label>Taxonomy</label>
            <div class="grid-3">
              <input id="plantFamily" placeholder="Family e.g., Araceae" />
              <input id="plantGenus" placeholder="Genus e.g., Monstera" />
              <input id="plantSpecies" placeholder="Species e.g., deliciosa" />
            </div>
            <div class="actions" style="justify-content:flex-start; gap:.5rem; margin-top:.5rem">
              <button type="button" id="suggestTaxonomy" class="btn">Suggest Taxonomy</button>
            </div>
            <div id="taxoSuggestions" class="taxo-suggestions"></div>
          </div>
          <div class="row">
            <label for="cultivar">Cultivar</label>
            <input id="cultivar" placeholder="e.g., 'Albo Variegata'" />
          </div>
          <div class="row">
            <label for="potDiameter">Pot diameter (cm)</label>
            <input id="potDiameter" type="number" min="3" step="1" placeholder="14" />
          </div>
          <div class="row">
            <label for="baseInterval">Base water interval (days)</label>
            <input id="baseInterval" type="number" min="1" step="1" value="7" required />
          </div>
          <div class="row">
            <label for="lightLevel">Light level</label>
            <select id="lightLevel">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div class="row">
            <label for="potSize">Pot size</label>
            <select id="potSize">
              <option value="small">Small</option>
              <option value="medium" selected>Medium</option>
              <option value="large">Large</option>
            </select>
          </div>
          <div class="row">
            <label>Soil & Location</label>
            <div class="grid-3">
              <select id="soilType">
                <option value="generic" selected>Generic potting mix</option>
                <option value="aroid">Aroid/tropical mix</option>
                <option value="cactus">Cactus/succulent mix</option>
              </select>
              <select id="exposure">
                <option value="">Exposure (optional)</option>
                <option value="N">North</option>
                <option value="E">East</option>
                <option value="S">South</option>
                <option value="W">West</option>
              </select>
              <select id="inout">
                <option value="indoor" selected>Indoor</option>
                <option value="outdoor">Outdoor</option>
              </select>
            </div>
            <div class="row" style="margin-top:.5rem">
              <input id="roomLabel" placeholder="Room / location (optional)" />
            </div>
            <div class="actions" style="justify-content:flex-start; gap:.5rem; margin-top:.5rem">
              <button type="button" id="usePlantWeather" class="btn">Use Weather for this Plant</button>
              <button type="button" id="clearPlantWeather" class="btn">Clear Plant Weather</button>
              <span id="plantWeatherTag" class="muted"></span>
            </div>
          </div>
          <div class="row">
            <label>Fine-tuning</label>
            <div class="grid-3">
              <input id="tuneIntervalPct" type="number" step="1" min="-50" max="50" placeholder="Interval % (e.g., -10 or 10)" />
              <input id="tuneVolumePct" type="number" step="1" min="-50" max="50" placeholder="Volume % (e.g., -10 or 10)" />
              <div></div>
            </div>
          </div>
          <div class="row">
            <label for="lastWatered">Last watered</label>
            <input id="lastWatered" type="date" />
          </div>
          <div class="row">
            <label>Watering Recommendation</label>
            <div id="waterRec" class="muted">—</div>
          </div>
          <div class="row">
            <label>Tasks</label>
            <div class="grid-3">
              <div class="task-field">
                <select id="task1Type">
                  <option value="">— none —</option>
                  <option value="fertilize">Fertilize</option>
                  <option value="repot">Repot</option>
                  <option value="prune">Prune</option>
                  <option value="inspect">Inspect</option>
                  <option value="mist">Mist</option>
                </select>
                <input id="task1Every" type="number" min="1" step="1" placeholder="Every (days)" />
              </div>
              <div class="task-field">
                <select id="task2Type">
                  <option value="">— none —</option>
                  <option value="fertilize">Fertilize</option>
                  <option value="repot">Repot</option>
                  <option value="prune">Prune</option>
                  <option value="inspect">Inspect</option>
                  <option value="mist">Mist</option>
                </select>
                <input id="task2Every" type="number" min="1" step="1" placeholder="Every (days)" />
              </div>
              <div class="task-field">
                <select id="task3Type">
                  <option value="">— none —</option>
                  <option value="fertilize">Fertilize</option>
                  <option value="repot">Repot</option>
                  <option value="prune">Prune</option>
                  <option value="inspect">Inspect</option>
                  <option value="mist">Mist</option>
                </select>
                <input id="task3Every" type="number" min="1" step="1" placeholder="Every (days)" />
              </div>
            </div>
          </div>
          <div class="row">
            <label for="notes">Notes</label>
            <textarea id="notes" rows="3" placeholder="Soil mix, location, etc."></textarea>
          </div>
          <div class="actions">
            <button type="button" class="btn" id="cancelEdit">Cancel</button>
            <button type="submit" class="btn primary">Save</button>
          </div>
        </form>
      </section>
    </main>

    <div id="detailsModal" class="modal">
      <div class="modal-content card">
        <div class="modal-header">
          <h3 id="detailsTitle">Plant Details</h3>
          <button id="detailsClose" class="btn ghost">Close</button>
        </div>
        <canvas id="historyCanvas" width="800" height="260"></canvas>
        <div id="detailsMeta" class="details-meta"></div>
        <div class="row">
          <label>Add Observation</label>
          <div class="obs-row">
            <input id="obsNote" placeholder="Observation note (growth, pests, bloom)" />
            <input id="obsPhoto" type="file" accept="image/*" capture="environment" />
            <button id="obsAddBtn" class="btn">Add</button>
          </div>
        </div>
        <div id="obsList" class="obs-list"></div>
        <div class="row">
          <label>Tasks</label>
          <div id="taskList" class="task-list"></div>
        </div>
      </div>
    </div>

    <footer class="app-footer">
      <span>Local-first, offline-ready</span>
    </footer>

    <script src="db.js"></script>
    <script src="config.js"></script>
    <script src="app.js"></script>
  </body>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
  </html>
